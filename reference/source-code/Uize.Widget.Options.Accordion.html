<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Uize.Widget.Options.Accordion | JavaScript Source Code | UIZE JavaScript Framework</title>
	<meta name="keywords" content="UIZE JavaScript Framework module source code"/>
	<meta name="description" content="This is the JavaScript source code for the Uize.Widget.Options.Accordion module of the UIZE JavaScript Framework"/>
	<link rel="alternate" type="application/rss+xml" title="UIZE JavaScript Framework - Latest News" href="http://www.uize.com/latest-news.rss"/>
	<link rel="stylesheet" href="../../css/page.css"/>
	<link rel="stylesheet" href="../../css/page.source.css"/>
</head>

<body>

<script type="text/javascript" src="../../js/Uize.js"></script>

<h1 class="document-title">
	<a id="page-homeLink" href="../../index.html" title="UIZE JavaScript Framework home"></a>
	SOURCE CODE: Uize.Widget.Options.Accordion
	<div class="pageActions">
		<a href="../Uize.Widget.Options.Accordion.html" class="buttonLink">VIEW REFERENCE</a>
	</div>
</h1>

<pre>
/*______________
|       ______  |   U I Z E    J A V A S C R I P T    F R A M E W O R K
|     /      /  |   ---------------------------------------------------
|    /    O /   |    MODULE : Uize.Widget.Options.Accordion Class
|   /    / /    |
|  /    / /  /| |    ONLINE : http://www.uize.com
| /____/ /__/_| | COPYRIGHT : (c)2007-2011 UIZE
|           |__ |   LICENSE : Available under MIT License or GNU General Public License
|_______________|             http://www.uize.com/license.html
*/

/*ScruncherSettings Mappings="=d" LineCompacting="TRUE"*/

/* Module Meta Data
  type: Class
  importance: 4
  codeCompleteness: 100
  testCompleteness: 0
  docCompleteness: 2
*/

/*?
  Introduction
    The =Uize.Widget.Options.Accordion= class extends its superclass by adding an accordion style behavior for revealing the contents of the selected tab.

    *DEVELOPERS:* `Jan Borgersen`
*/

Uize.module ({
  name:'Uize.Widget.Options.Accordion',
  required:[
    'Uize.Node',
    'Uize.Fade'
  ],
  builder:function (_superclass) {
    /*** Variables for Scruncher Optimization ***/
      var
        _true = true,
        _false = false,
        _null = null,
        _Uize_Node = Uize.Node
      ;

    /*** Class Constructor ***/
      var
        _class = _superclass.subclass (
          _null,
          function () {
            var _this = this;

            /*** Private Instance Properties ***/
              _this.fade = new Uize.Fade ({
                curve:Uize.Fade.celeration (0,1),
                duration:500
              });

            _this.wire (
              'Changed.value',
              function () { _this._updateUiTabBodies (_true) }
            );
          }
        ),
        _classPrototype = _class.prototype
      ;

    /*** Private Instance Methods ***/
      _classPrototype._resolveToValueNo = function (_valueOrValueNo) {
        return Uize.isNumber (_valueOrValueNo) ? _valueOrValueNo : this.getValueNoFromValue (_valueOrValueNo);
      };

      _classPrototype._getTabBodyNode = function (_valueOrValueNo) {
        return this.getNode ('option' + this._resolveToValueNo (_valueOrValueNo) + 'TabBody')
      };

      _classPrototype._updateUiOptionToggle = function(_optionNo, _isVisible) {
        var
          _optionButton = this.getOptionButton( _optionNo ),
          _toggleNode = _optionButton.getNode('toggle'),
          _toggleParentNode = _toggleNode ? _toggleNode.parentNode : _null,
          _toggleParentNodeDimensions = _toggleParentNode ? _Uize_Node.getDimensions(_toggleParentNode) : _null
        ;
        _toggleNode &amp;&amp;
          this.setNodeStyle(_toggleNode, {top:_isVisible ? -_toggleParentNodeDimensions.height : 0})
        ;
      };

      _classPrototype._updateUiTabBodies = function (_showAnimation) {
        var _this = this;

        if (_this.isWired) {
          var
            _valueNo = _this.get('valueNo'),
            _buttonHeights = _this._buttonHeights,
            _buttonHeightsLength = _buttonHeights.length,
            _top = 0
          ;

          if( _showAnimation ) {
            if( _valueNo != _this._lastShownTabBodyNo ) {
              _this.fade.stop();
              _this._growingNode = _this._getTabBodyNode( _valueNo );
              _this._shrinkingNode = _this._getTabBodyNode( _this._lastShownTabBodyNo );

              for (var _tabNo = -1; ++_tabNo &lt; _buttonHeightsLength;) {
                _this.displayNode( _this._getTabBodyNode(_tabNo), (_tabNo == _valueNo || _tabNo == _this._lastShownTabBodyNo) );
                _this._updateUiOptionToggle(_tabNo, _valueNo == _tabNo);
              }

              _this.setNodeStyle(_this._growingNode, {height:1});
              _this.setNodeStyle(_this._shrinkingNode,{height:_this._maxTabHeight});
              _this.fade.start();
            }
          } else {
            for (var _tabNo = -1; ++_tabNo &lt; _buttonHeightsLength;) {
              var _tabNode = _this._getTabBodyNode( _tabNo );
              _this.getOptionButton( _tabNo ).setNodeStyle('',{top:_top});
              _top += _buttonHeights[ _tabNo ];
              if( _valueNo == _tabNo ) {
                _this.displayNode(_tabNode);
                _this.setNodeStyle(_tabNode,{top:_top,height:_this._maxTabHeight});
                _top += _this._maxTabHeight;
              } else {
                _this.displayNode(_tabNode,_false);
              }
              _this._updateUiOptionToggle(_tabNo, _valueNo == _tabNo);
            }
          }
        }
      };

    /*** Public Instance Methods ***/
      _classPrototype.getOptionButton = function (_valueOrValueNo) {
        return this.children ['option' + this._resolveToValueNo (_valueOrValueNo)]
      };

      _classPrototype.tabExists = function (_valueOrValueNo) {
        var _optionButton = this.getOptionButton (_valueOrValueNo);
        return (
          _optionButton &amp;&amp; (_optionButton.getNode () || this._getTabBodyNode (_valueOrValueNo))
            ? true
            : false
        );
      };

      _classPrototype.wireUi = function () {
        var _this = this;
        if (!_this.isWired) {
          _superclass.prototype.wireUi.call (_this);

          /*** grab explicit heights and set absolute positioning ***/
            var
              _values = _this.get('values'),
              _shellHeight = _Uize_Node.getCoords( _this.getNode() ).height,
              _totalButtonHeights = 0
            ;
            _this._buttonHeights = [];
            for (
              var _valueNo = -1, _values = _this.get ('values'), _valuesLength = _values.length;
              ++_valueNo &lt; _valuesLength;
            ) {
              var
                _buttonNode = _this.getOptionButton(_valueNo).getNode(),
                _tabNode = _this._getTabBodyNode( _valueNo )
              ;
              _this._buttonHeights[ _valueNo ] = _Uize_Node.getCoords( _buttonNode ).height;
              _totalButtonHeights += _this._buttonHeights[ _valueNo ];
              _this.setNodeStyle([_buttonNode,_tabNode],{position:'absolute'/*,overflow:'hidden'*/});
            }
            _this._maxTabHeight = _shellHeight - _totalButtonHeights;

          /*** setup ui ***/
            _this._growingTab = _this._shrinkingTab = _null;
            if( _this.get ('valueNo') &lt; 0 )
              _this.set({valueNo:0})
            ;
            _this._lastShownTabBodyNo = _this.get ('valueNo');

            _this.fade.set ({
              startValue:0,
              endValue:_this._maxTabHeight
            });

            var _growingNodeOverflow, _shrinkingNodeOverflow;

            _this.fade.wire ({
              Start:function() {
                _growingNodeOverflow = _this.getNodeStyle(_this._growingNode, 'overflow');
                _shrinkingNodeOverflow = _this.getNodeStyle(_this._shrinkingNode, 'overflow');

                _this.setNodeStyle(_this._growingNode, {overflow:'hidden'});
                _this.setNodeStyle(_this._shrinkingNode, {overflow:'hidden'});
              },
              'Changed.value':function () {
                var
                  _valueNo = _this.get('valueNo'),
                  _top = 0,
                  _growingValue = +_this.fade,
                  _shrinkingValue = _this._maxTabHeight - _growingValue
                ;
                // first set heights
                _this.setNodeStyle(_this._growingNode,{height:_growingValue});
                _this.setNodeStyle(_this._shrinkingNode,{height:_shrinkingValue});
                // then adjust positions
                for(
                  var
                    _tabNo = -1,
                    _buttonHeights = _this._buttonHeights,
                    _buttonHeightsLength = _buttonHeights.length
                  ;
                  ++_tabNo &lt; _buttonHeightsLength;
                ) {
                  _this.getOptionButton( _tabNo ).setNodeStyle('', {top:_top});
                  _top += _buttonHeights[ _tabNo ];

                  if( _tabNo == _valueNo ) { // growing
                    _this.setNodeStyle(_this._growingNode,{top:_top});
                    _top += _growingValue;
                  } else if( _tabNo == _this._lastShownTabBodyNo ) { // shrinking
                    _this.setNodeStyle(_this._shrinkingNode,{top:_top});
                    _top += _shrinkingValue;
                  }
                }
              },
              Done:function () {
                _this.displayNode(_this._shrinkingNode, _false);
                _this.setNodeStyle(_this._growingNode, {overflow:_growingNodeOverflow});
                _this.setNodeStyle(_this._shrinkingNode, {overflow:_shrinkingNodeOverflow});
                _this._lastShownTabBodyNo = _this.get('valueNo');
              }
            });

            _this._updateUiTabBodies (_false);
        }
      };

    return _class;
  }
});


</pre>

<script type="text/javascript">

Uize.module ({
	required:[
		'UizeDotCom.Page.library',
		'UizeDotCom.Page'
	],
	builder:function () {(window.page = new UizeDotCom.Page).wireUi ()}
});

</script>

</body></html>
